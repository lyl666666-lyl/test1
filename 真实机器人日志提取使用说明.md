# 机器人日志提取系统 - 使用说明

## 快速开始

比赛结束后，运行这个命令：
```bash
./extract_team_logs_simple.sh
```

日志会自动保存到 `Config/Real_Logs/时间戳/` 目录。

---

## 功能说明

### 1. 自动提取日志
- **TeamA**: 10.0.70.15（队内3号位）
- **TeamB**: 10.0.70.13（队内3号位）

### 2. 提取内容
- `team_comm_*.txt` - 原始团队通信日志
- `team_comm_*_enhanced.txt` - 增强版日志（推荐查看）
- `bhumand_*.log` - 系统日志

### 3. 增强版日志包含
- ⚡ 电池电量警告
- 🌡️ 关节温度警告
- 🤖 机器人状态（站立/倒地）
- 📝 启动信息（队伍号、球员号）
- 📂 完整日志文件路径

---

## 使用方法

### 基本用法
```bash
# 提取最近10分钟的日志（默认）
./extract_team_logs_simple.sh

# 提取最近5分钟的日志
./extract_team_logs_simple.sh 5

# 提取最近30分钟的日志
./extract_team_logs_simple.sh 30
```

### 查看日志
提取完成后，打开以下文件：
```
Config/Real_Logs/20260128_143230/
├── TeamA/
│   └── player3_robot15/
│       └── team_comm_p3_enhanced.txt  ← 查看这个
└── TeamB/
    └── player3_robot13/
        └── team_comm_p3_enhanced.txt  ← 查看这个
```

---

## 配置说明

如需修改机器人配置，编辑 `extract_team_logs_simple.sh`：

```bash
# 队伍A配置
TEAM_A=(
    "10.0.70.15:3"    # IP:队内位置
    # "10.0.70.2:2"   # 取消注释添加更多机器人
)

# 队伍B配置
TEAM_B=(
    "10.0.70.13:3"
)
```

---

## 代码修改记录

### 1. 日志文件时间戳功能
**修改文件**：
- `Src/Libs/Framework/LoggingTools.cpp`
- `Make/Python/Src/Libs/Framework/LoggingTools.cpp`

**修改内容**：
在 `createName()` 函数中添加时间戳前缀（格式：YYYYMMDD_HHMMSS）

**效果**：
- 旧格式：`fly11_fly11_Default_Default__Testing_2.log`
- 新格式：`20260127_143025_fly11_fly11_Default_Default__Testing_2.log`

### 2. 团队通信日志增强
**修改文件**：
- `Src/Modules/Communication/TeamMessageHandler/TeamMessageHandler.cpp`
- `Make/Python/Src/Modules/Communication/TeamMessageHandler/TeamMessageHandler.cpp`

**修改内容**：
在 `team_comm_*.txt` 文件中添加详细信息：
- 电池电量和关节温度
- 机器人状态（站立/倒地/蹲下）
- 当前动作（activity）
- 射门目标
- 裁判手势识别
- 哨声检测

**注意**：此功能需要重新编译并部署到机器人才能生效。

---

## 示例效果

查看虚拟示例：
```
Config/Real_Logs/示例_虚拟效果/
```

增强版日志示例内容：
```
========================================
团队通信日志 - 原始内容
========================================

[2026-01-28 14:30:15] 发送消息到队友
  队伍号: 17
  球员号: 3
  球位置: (1250, -800) 置信度: 0.85
  机器人位置: (500, 300, 45°)
  角色: striker (前锋)
  动作: dribble (带球)

========================================
从 bhumand 日志提取的额外信息
========================================

## 电池电量警告
  [2026-01-28 14:32:10] ⚠️ Low Battery Warning: 45%

## 温度警告
  [2026-01-28 14:32:00] ⚠️ High temperature: RKneePitch 71°C

## 机器人状态变化
  [2026-01-28 14:31:30] ⚠️ Robot state: fallen (倒地)
  [2026-01-28 14:31:45] Robot state: upright (站立)
```

---

## 常见问题

### Q: 提取不到日志？
A: 检查：
1. 机器人是否在线（ping 10.0.70.15）
2. SSH密码是否正确
3. 时间范围是否太短（尝试增加分钟数）

### Q: 增强版日志没有额外信息？
A: 可能原因：
1. 机器人上运行的是旧代码（未包含增强功能）
2. bhumand 日志文件不存在或为空

### Q: 如何修改提取的机器人？
A: 编辑 `extract_team_logs_simple.sh` 中的 TEAM_A 和 TEAM_B 配置。

---

## 文件清单

### 核心文件
- `extract_team_logs_simple.sh` - 日志提取脚本
- `日志提取使用说明.md` - 本文档
- `日志文件时间戳说明.md` - 时间戳功能详细说明

### 修改的代码文件
- `Src/Libs/Framework/LoggingTools.cpp`
- `Make/Python/Src/Libs/Framework/LoggingTools.cpp`
- `Src/Modules/Communication/TeamMessageHandler/TeamMessageHandler.cpp`
- `Make/Python/Src/Modules/Communication/TeamMessageHandler/TeamMessageHandler.cpp`

### 示例文件
- `Config/Real_Logs/示例_虚拟效果/` - 虚拟示例效果

---

## 编译说明

修改代码后需要重新编译：

```bash
cd Make/Linux
make

# 部署到机器人
./copyfiles 10.0.70.15
./copyfiles 10.0.70.13
```

---

**最后更新**: 2026-01-28
